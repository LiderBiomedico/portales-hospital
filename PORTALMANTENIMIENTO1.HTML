<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hospital Susana L√≥pez de Valencia - Portal Gesti√≥n de Solicitudes</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: #f1f8f5;
            line-height: 1.6;
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 1rem;
        }

        /* Header */
        .header {
            background: linear-gradient(135deg, #2563eb 0%, #059669 100%);
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 100;
            color: white;
        }

        .header-content {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: auto;
            min-height: 5rem;
            padding: 1rem;
            position: relative;
            gap: 0.5rem;
        }

        .logo {
            display: flex;
            align-items: center;
            flex: 1;
            min-width: 0;
        }

        .hospital-info h1 {
            font-size: 1.2rem;
            font-weight: bold;
            color: white;
            line-height: 1.2;
            text-shadow: 0 1px 2px rgba(0,0,0,0.1);
            margin: 0;
            word-wrap: break-word;
            max-width: 100%;
            text-align: center;
        }

        .hospital-info p {
            font-size: 0.85rem;
            color: #e0f2fe;
            font-weight: 500;
            margin-top: 0.25rem;
            margin-bottom: 0;
            word-wrap: break-word;
            max-width: 100%;
            text-align: center;
        }

        .developer-credit {
            font-size: 0.75rem;
            color: #bfdbfe;
            font-weight: 400;
            margin-top: 0.25rem;
            margin-bottom: 0;
            text-align: center;
            font-style: italic;
        }

        .nav-tabs {
            display: flex;
            gap: 0.5rem;
            margin-top: 1rem;
            flex-wrap: wrap;
            justify-content: center;
        }

        .nav-tab {
            padding: 0.75rem 1.25rem;
            background: rgba(255,255,255,0.1);
            border: none;
            border-radius: 0.5rem;
            font-size: 0.875rem;
            font-weight: 500;
            color: white;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            backdrop-filter: blur(10px);
        }

        .nav-tab.active {
            background: white;
            color: #059669;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .nav-tab:hover:not(.active) {
            background: rgba(255,255,255,0.2);
        }

        .user-info {
            position: absolute;
            top: 1rem;
            right: 1rem;
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .notification-btn {
            position: relative;
            background: rgba(255,255,255,0.1);
            border: none;
            cursor: pointer;
            padding: 0.75rem;
            border-radius: 0.5rem;
            transition: background 0.2s;
            color: white;
            backdrop-filter: blur(10px);
        }

        .notification-btn:hover {
            background: rgba(255,255,255,0.2);
        }

        .notification-badge {
            position: absolute;
            top: 0.25rem;
            right: 0.25rem;
            background: #ef4444;
            color: white;
            border-radius: 50%;
            width: 1rem;
            height: 1rem;
            font-size: 0.625rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }

        /* Main Layout */
        .main-layout {
            display: grid;
            grid-template-columns: 1fr;
            gap: 1.5rem;
            padding: 1.5rem 1rem;
        }

        /* Cards */
        .card {
            background: white;
            border-radius: 1rem;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
            overflow: hidden;
            border: 1px solid #e5e7eb;
        }

        .card-header {
            padding: 1.5rem;
            border-bottom: 1px solid #e5e7eb;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: linear-gradient(135deg, #f8fafc 0%, #e0f2fe 100%);
        }

        .card-title {
            font-size: 1.125rem;
            font-weight: 600;
            color: #1f2937;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .card-content {
            padding: 1.5rem;
        }

        /* Metrics Grid */
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .metric-card {
            background: white;
            padding: 1.5rem;
            border-radius: 1rem;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
            text-align: center;
            border-top: 4px solid;
            transition: transform 0.2s, box-shadow 0.2s;
            cursor: pointer;
        }

        .metric-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 15px rgba(0,0,0,0.1);
        }

        .metric-card.total { 
            border-top-color: #2563eb; 
            background: linear-gradient(135deg, #ffffff 0%, #dbeafe 100%);
        }
        .metric-card.biomedica { 
            border-top-color: #059669; 
            background: linear-gradient(135deg, #ffffff 0%, #dcfce7 100%);
        }
        .metric-card.mecanica { 
            border-top-color: #f59e0b; 
            background: linear-gradient(135deg, #ffffff 0%, #fef3c7 100%);
        }
        .metric-card.infraestructura { 
            border-top-color: #8b5cf6; 
            background: linear-gradient(135deg, #ffffff 0%, #ede9fe 100%);
        }
        .metric-card.pendientes { 
            border-top-color: #ef4444; 
            background: linear-gradient(135deg, #ffffff 0%, #fee2e2 100%);
        }

        .metric-icon {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
        }

        .metric-number {
            font-size: 2.5rem;
            font-weight: bold;
            color: #1f2937;
        }

        .metric-label {
            font-size: 0.875rem;
            color: #6b7280;
            font-weight: 500;
        }

        /* Area Tabs */
        .area-tabs {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
        }

        .area-tab {
            padding: 0.75rem 1.5rem;
            border: 2px solid #e5e7eb;
            border-radius: 0.75rem;
            background: white;
            cursor: pointer;
            transition: all 0.2s;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .area-tab.active {
            border-color: #059669;
            background: #dcfce7;
            color: #065f46;
        }

        .area-tab:hover:not(.active) {
            border-color: #d1d5db;
            background: #f9fafb;
        }

        .area-tab.biomedica.active {
            border-color: #059669;
            background: #dcfce7;
        }

        .area-tab.mecanica.active {
            border-color: #f59e0b;
            background: #fef3c7;
        }

        .area-tab.infraestructura.active {
            border-color: #8b5cf6;
            background: #ede9fe;
        }

        /* Action buttons */
        .btn {
            padding: 0.625rem 1.25rem;
            border-radius: 0.5rem;
            font-size: 0.875rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            border: none;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            text-decoration: none;
        }

        .btn-primary {
            background: linear-gradient(135deg, #2563eb 0%, #1e40af 100%);
            color: white;
        }

        .btn-primary:hover {
            background: linear-gradient(135deg, #1e40af 0%, #1e3a8a 100%);
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(37, 99, 235, 0.3);
        }

        .btn-success {
            background: linear-gradient(135deg, #059669 0%, #047857 100%);
            color: white;
        }

        .btn-success:hover {
            background: linear-gradient(135deg, #047857 0%, #065f46 100%);
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(5, 150, 105, 0.3);
        }

        .btn-warning {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            color: white;
        }

        .btn-warning:hover {
            background: linear-gradient(135deg, #d97706 0%, #b45309 100%);
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(245, 158, 11, 0.3);
        }

        .btn-secondary {
            background: #6b7280;
            color: white;
        }

        .btn-secondary:hover {
            background: #4b5563;
            transform: translateY(-1px);
        }

        .btn-danger {
            background: #ef4444;
            color: white;
        }

        .btn-danger:hover {
            background: #dc2626;
            transform: translateY(-1px);
        }

        .btn-sm {
            padding: 0.5rem 1rem;
            font-size: 0.75rem;
        }

        /* Modal */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .modal-content {
            background: white;
            border-radius: 1rem;
            padding: 0;
            max-width: 600px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 25px rgba(0, 0, 0, 0.3);
        }

        .modal-header {
            padding: 1.5rem;
            border-bottom: 1px solid #e5e7eb;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: linear-gradient(135deg, #f8fafc 0%, #e0f2fe 100%);
        }

        .modal-title {
            font-size: 1.125rem;
            font-weight: 600;
            color: #1f2937;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 1.25rem;
            cursor: pointer;
            color: #6b7280;
            padding: 0.5rem;
            border-radius: 0.375rem;
        }

        .modal-close:hover {
            background: #f3f4f6;
            color: #1f2937;
        }

        /* Form */
        .form-group {
            margin-bottom: 1rem;
        }

        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: #374151;
        }

        .form-input, .form-select {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #d1d5db;
            border-radius: 0.5rem;
            font-size: 0.875rem;
            transition: border-color 0.2s;
        }

        .form-input:focus, .form-select:focus {
            outline: none;
            border-color: #2563eb;
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        /* Technician cards */
        .technician-card {
            background: #f8fafc;
            border: 1px solid #e5e7eb;
            border-radius: 0.75rem;
            padding: 1rem;
            margin-bottom: 1rem;
            transition: all 0.2s;
        }

        .technician-card:hover {
            border-color: #2563eb;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .technician-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
        }

        .technician-name {
            font-weight: 600;
            color: #1f2937;
            font-size: 1rem;
        }

        .technician-id {
            background: #2563eb;
            color: white;
            padding: 0.25rem 0.5rem;
            border-radius: 0.375rem;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .technician-details {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0.5rem;
            margin-bottom: 1rem;
            font-size: 0.875rem;
        }

        .technician-detail {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: #6b7280;
        }

        .technician-actions {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }

        .status-disponible {
            background: #dcfce7;
            color: #166534;
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .status-ocupado {
            background: #fef3c7;
            color: #d97706;
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .status-inactivo {
            background: #fee2e2;
            color: #dc2626;
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .status-pendiente {
            background: #fef3c7;
            color: #d97706;
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .status-asignada {
            background: #dbeafe;
            color: #1e40af;
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .status-proceso {
            background: #fed7aa;
            color: #ea580c;
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .status-completada {
            background: #dcfce7;
            color: #166534;
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        /* Request cards */
        .request-card {
            background: #f8fafc;
            border: 1px solid #e5e7eb;
            border-radius: 0.75rem;
            padding: 1.5rem;
            margin-bottom: 1rem;
            transition: all 0.2s;
        }

        .request-card:hover {
            border-color: #2563eb;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .request-card.pending {
            border-left: 4px solid #f59e0b;
            background: linear-gradient(135deg, #fffbeb 0%, #fef3c7 100%);
        }

        .request-card.assigned {
            border-left: 4px solid #2563eb;
            background: linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%);
        }

        .request-card.completed {
            border-left: 4px solid #059669;
            background: linear-gradient(135deg, #ecfdf5 0%, #dcfce7 100%);
        }

        .request-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            flex-wrap: wrap;
            gap: 0.5rem;
        }

        .request-number {
            font-weight: 600;
            color: #1f2937;
            font-size: 1.125rem;
        }

        .request-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 1rem;
            font-size: 0.875rem;
        }

        .request-detail {
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
        }

        .request-detail-label {
            font-weight: 600;
            color: #6b7280;
        }

        .request-detail-value {
            color: #1f2937;
        }

        .request-actions {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
            margin-top: 1rem;
        }

        /* Views */
        .view {
            display: block;
        }

        .view.hidden {
            display: none;
        }

        /* Alert */
        .alert {
            padding: 1rem;
            border-radius: 0.5rem;
            border-left: 4px solid;
            margin-bottom: 1.5rem;
        }

        .alert-info {
            background: #eff6ff;
            border-color: #3b82f6;
            color: #1e40af;
        }

        .alert-success {
            background: #f0fdf4;
            border-color: #22c55e;
            color: #15803d;
        }

        .alert-warning {
            background: #fffbeb;
            border-color: #f59e0b;
            color: #d97706;
        }

        .alert-danger {
            background: #fef2f2;
            border-color: #ef4444;
            color: #dc2626;
        }

        /* System status */
        .system-status {
            position: fixed;
            bottom: 1rem;
            right: 1rem;
            background: white;
            padding: 0.75rem;
            border-radius: 0.75rem;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            border: 2px solid #059669;
            font-size: 0.875rem;
        }

        .status-online {
            color: #059669;
            font-weight: 600;
        }

        /* Access Code Display */
        .access-code-display {
            background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%);
            border: 2px solid #2563eb;
            border-radius: 1rem;
            padding: 1rem;
            text-align: center;
            margin: 1rem 0;
            box-shadow: 0 4px 6px rgba(37, 99, 235, 0.1);
        }

        .access-code-number {
            font-size: 2.5rem;
            font-weight: bold;
            color: #1e40af;
            letter-spacing: 0.5rem;
            font-family: 'Courier New', monospace;
            margin: 0.5rem 0;
            text-shadow: 0 2px 4px rgba(30, 64, 175, 0.3);
        }

        .access-code-label {
            font-size: 0.875rem;
            color: #1e40af;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .access-code-info {
            font-size: 0.75rem;
            color: #3b82f6;
            margin-top: 0.5rem;
        }

        /* Hidden class utility */
        .hidden {
            display: none !important;
        }

        /* Persistence indicator */
        .persistence-status {
            background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%);
            border: 2px solid #22c55e;
            border-radius: 0.75rem;
            padding: 1rem;
            margin: 1rem 0;
            text-align: center;
        }

        .persistence-status h4 {
            color: #15803d;
            margin-bottom: 0.5rem;
            font-size: 1rem;
        }

        .persistence-status p {
            color: #166534;
            font-size: 0.875rem;
            margin: 0;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .header-content {
                padding: 1rem;
                gap: 1rem;
            }

            .user-info {
                position: static;
                justify-content: center;
                margin-top: 1rem;
            }

            .hospital-info h1 {
                font-size: 1rem;
                text-align: center;
            }

            .hospital-info p {
                font-size: 0.75rem;
                text-align: center;
            }

            .nav-tabs {
                width: 100%;
                justify-content: center;
                margin-top: 1rem;
            }

            .metrics-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .technician-details {
                grid-template-columns: 1fr;
            }

            .technician-actions {
                justify-content: center;
            }

            .request-details {
                grid-template-columns: 1fr;
            }

            .request-actions {
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="header-content container">
            <div class="logo">
                <div class="hospital-info">
                    <h1>HOSPITAL SUSANA LOPEZ DE VALENCIA E.S.E.</h1>
                    <p class="developer-credit">Desarrollado por Ing. Paul Eduardo Mu√±oz R.</p>
                    <p>Portal Gesti√≥n de Solicitudes - Sistema Integrado con Persistencia</p>
                </div>
            </div>

            <nav class="nav-tabs">
                <button class="nav-tab active" onclick="showView('dashboard')" data-view="dashboard">
                    üìä Dashboard
                </button>
                <button class="nav-tab" onclick="showView('solicitudes')" data-view="solicitudes">
                    üìã Gesti√≥n (<span id="total-count">0</span>)
                </button>
                <button class="nav-tab" onclick="showView('areas')" data-view="areas">
                    üîß Por √Åreas
                </button>
                <button class="nav-tab" onclick="showView('tecnicos')" data-view="tecnicos">
                    üë• Personal (<span id="total-technicians-nav">0</span>)
                </button>
                <button class="nav-tab" onclick="showView('accesos')" data-view="accesos">
                    üîê Accesos (<span id="pending-access-count">0</span>)
                </button>
                <button class="nav-tab" onclick="showView('reportes')" data-view="reportes">
                    üìà Reportes
                </button>
            </nav>

            <div class="user-info">
                <button class="notification-btn" onclick="showNotifications()">
                    üîî
                    <span class="notification-badge" id="notification-count">0</span>
                </button>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="main-layout container">
        <!-- Dashboard View -->
        <div id="dashboard-view" class="view">
            <!-- Estado de Persistencia -->
            <div class="persistence-status">
                <h4>‚úÖ Sistema de Persistencia Activado</h4>
                <p>Todos los datos se guardan autom√°ticamente y permanecen disponibles en GitHub Pages</p>
            </div>

            <!-- Alertas de Solicitudes Cr√≠ticas -->
            <div id="critical-alerts"></div>

            <!-- Metrics por √Årea de Ingenier√≠a -->
            <div class="metrics-grid">
                <div class="metric-card total" onclick="filterByArea('all')">
                    <div class="metric-icon">üìã</div>
                    <div class="metric-number" id="metric-total">0</div>
                    <div class="metric-label">Total Solicitudes</div>
                </div>
                <div class="metric-card biomedica" onclick="filterByArea('INGENIERIA_BIOMEDICA')">
                    <div class="metric-icon">üè•</div>
                    <div class="metric-number" id="metric-biomedica">0</div>
                    <div class="metric-label">Ingenier√≠a Biom√©dica</div>
                </div>
                <div class="metric-card mecanica" onclick="filterByArea('MECANICA')">
                    <div class="metric-icon">‚öôÔ∏è</div>
                    <div class="metric-number" id="metric-mecanica">0</div>
                    <div class="metric-label">Mec√°nica</div>
                </div>
                <div class="metric-card infraestructura" onclick="filterByArea('INFRAESTRUCTURA')">
                    <div class="metric-icon">üèóÔ∏è</div>
                    <div class="metric-number" id="metric-infraestructura">0</div>
                    <div class="metric-label">Infraestructura</div>
                </div>
                <div class="metric-card pendientes" onclick="filterByStatus('PENDIENTE')">
                    <div class="metric-icon">‚è≥</div>
                    <div class="metric-number" id="metric-pendientes">0</div>
                    <div class="metric-label">Pendientes Asignaci√≥n</div>
                </div>
            </div>

            <!-- Resumen de Personal por √Årea -->
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1rem;">
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">üè• Personal Biom√©dica</h2>
                        <span class="status-disponible" id="biomedica-personnel-count">0 registrados</span>
                    </div>
                    <div class="card-content">
                        <div id="biomedica-personnel-summary">
                            <p style="color: #6b7280; text-align: center;">No hay personal registrado</p>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">‚öôÔ∏è Personal Mec√°nica</h2>
                        <span class="status-disponible" id="mecanica-personnel-count">0 registrados</span>
                    </div>
                    <div class="card-content">
                        <div id="mecanica-personnel-summary">
                            <p style="color: #6b7280; text-align: center;">No hay personal registrado</p>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">üèóÔ∏è Personal Infraestructura</h2>
                        <span class="status-disponible" id="infraestructura-personnel-count">0 registrados</span>
                    </div>
                    <div class="card-content">
                        <div id="infraestructura-personnel-summary">
                            <p style="color: #6b7280; text-align: center;">No hay personal registrado</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Solicitudes View -->
        <div id="solicitudes-view" class="view hidden">
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">üìã Gesti√≥n General de Solicitudes</h2>
                    <div style="display: flex; gap: 0.5rem;">
                        <button class="btn btn-success btn-sm" onclick="addSampleRequest()">
                            ‚ûï Agregar Solicitud de Prueba
                        </button>
                        <button class="btn btn-primary btn-sm" onclick="syncData()">
                            üîÑ Sincronizar Datos
                        </button>
                    </div>
                </div>
                <div class="card-content">
                    <div id="solicitudes-list">
                        <div style="text-align: center; padding: 3rem; color: #6b7280;">
                            <div style="font-size: 4rem; margin-bottom: 1rem;">üìã</div>
                            <h3 style="color: #1f2937; margin-bottom: 0.5rem;">No hay solicitudes registradas</h3>
                            <p style="margin-bottom: 1.5rem;">Las solicitudes aparecer√°n aqu√≠ y se guardar√°n autom√°ticamente</p>
                            <button class="btn btn-primary" onclick="addSampleRequest()">
                                ‚ûï Agregar Solicitud de Prueba
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Areas View -->
        <div id="areas-view" class="view hidden">
            <div class="area-tabs">
                <div class="area-tab active biomedica" onclick="showAreaTab('biomedica')" data-area="biomedica">
                    üè• Ingenier√≠a Biom√©dica (<span id="tab-biomedica-count">0</span>)
                </div>
                <div class="area-tab mecanica" onclick="showAreaTab('mecanica')" data-area="mecanica">
                    ‚öôÔ∏è Mec√°nica (<span id="tab-mecanica-count">0</span>)
                </div>
                <div class="area-tab infraestructura" onclick="showAreaTab('infraestructura')" data-area="infraestructura">
                    üèóÔ∏è Infraestructura (<span id="tab-infraestructura-count">0</span>)
                </div>
            </div>

            <div id="area-biomedica" class="area-content">
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">üè• Solicitudes - Ingenier√≠a Biom√©dica</h2>
                        <button class="btn btn-primary btn-sm" onclick="showAreaRequests('INGENIERIA_BIOMEDICA')">
                            üîÑ Actualizar
                        </button>
                    </div>
                    <div class="card-content">
                        <div id="biomedica-requests">
                            <p style="text-align: center; color: #6b7280;">Las solicitudes del √°rea aparecer√°n aqu√≠...</p>
                        </div>
                    </div>
                </div>
            </div>

            <div id="area-mecanica" class="area-content hidden">
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">‚öôÔ∏è Solicitudes - Mec√°nica</h2>
                        <button class="btn btn-primary btn-sm" onclick="showAreaRequests('MECANICA')">
                            üîÑ Actualizar
                        </button>
                    </div>
                    <div class="card-content">
                        <div id="mecanica-requests">
                            <p style="text-align: center; color: #6b7280;">Las solicitudes del √°rea aparecer√°n aqu√≠...</p>
                        </div>
                    </div>
                </div>
            </div>

            <div id="area-infraestructura" class="area-content hidden">
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">üèóÔ∏è Solicitudes - Infraestructura</h2>
                        <button class="btn btn-primary btn-sm" onclick="showAreaRequests('INFRAESTRUCTURA')">
                            üîÑ Actualizar
                        </button>
                    </div>
                    <div class="card-content">
                        <div id="infraestructura-requests">
                            <p style="text-align: center; color: #6b7280;">Las solicitudes del √°rea aparecer√°n aqu√≠...</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tecnicos View -->
        <div id="tecnicos-view" class="view hidden">
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">üë• Gesti√≥n de Personal T√©cnico ‚úÖ PERSISTENCIA ACTIVA</h2>
                    <div style="display: flex; gap: 0.5rem;">
                        <button class="btn btn-success btn-sm" onclick="showAddTechnicianModal()">
                            ‚ûï Agregar Personal
                        </button>
                        <button class="btn btn-primary btn-sm" onclick="addSampleTechnicians()">
                            üß™ Agregar Personal de Prueba
                        </button>
                        <button class="btn btn-warning btn-sm" onclick="clearAllTechnicians()">
                            üóëÔ∏è Limpiar Todos
                        </button>
                    </div>
                </div>
            </div>

            <!-- Personal por √Årea -->
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(400px, 1fr)); gap: 1.5rem;">
                <!-- Ingenier√≠a Biom√©dica -->
                <div class="card">
                    <div class="card-header" style="background: linear-gradient(135deg, #ecfdf5 0%, #dcfce7 100%);">
                        <h3 class="card-title" style="color: #065f46;">üè• Ingenier√≠a Biom√©dica</h3>
                        <div style="display: flex; gap: 0.5rem;">
                            <span class="status-disponible" id="biomedica-total">0 personas</span>
                            <button class="btn btn-success btn-sm" onclick="showAddTechnicianModal('INGENIERIA_BIOMEDICA')">
                                ‚ûï Agregar
                            </button>
                        </div>
                    </div>
                    <div class="card-content">
                        <div id="biomedica-technicians-list">
                            <div style="text-align: center; padding: 2rem; color: #6b7280;">
                                <div style="font-size: 3rem; margin-bottom: 1rem;">üè•</div>
                                <h4>No hay personal registrado</h4>
                                <p style="font-size: 0.875rem;">El personal se guardar√° autom√°ticamente</p>
                                <button class="btn btn-primary btn-sm" onclick="showAddTechnicianModal('INGENIERIA_BIOMEDICA')" style="margin-top: 1rem;">
                                    ‚ûï Agregar Primera Persona
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Mec√°nica -->
                <div class="card">
                    <div class="card-header" style="background: linear-gradient(135deg, #fefbeb 0%, #fef3c7 100%);">
                        <h3 class="card-title" style="color: #d97706;">‚öôÔ∏è Mec√°nica</h3>
                        <div style="display: flex; gap: 0.5rem;">
                            <span class="status-ocupado" id="mecanica-total">0 personas</span>
                            <button class="btn btn-warning btn-sm" onclick="showAddTechnicianModal('MECANICA')">
                                ‚ûï Agregar
                            </button>
                        </div>
                    </div>
                    <div class="card-content">
                        <div id="mecanica-technicians-list">
                            <div style="text-align: center; padding: 2rem; color: #6b7280;">
                                <div style="font-size: 3rem; margin-bottom: 1rem;">‚öôÔ∏è</div>
                                <h4>No hay personal registrado</h4>
                                <p style="font-size: 0.875rem;">El personal se guardar√° autom√°ticamente</p>
                                <button class="btn btn-primary btn-sm" onclick="showAddTechnicianModal('MECANICA')" style="margin-top: 1rem;">
                                    ‚ûï Agregar Primera Persona
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Infraestructura -->
                <div class="card">
                    <div class="card-header" style="background: linear-gradient(135deg, #f3f4f6 0%, #ede9fe 100%);">
                        <h3 class="card-title" style="color: #7c3aed;">üèóÔ∏è Infraestructura</h3>
                        <div style="display: flex; gap: 0.5rem;">
                            <span class="status-inactivo" id="infraestructura-total">0 personas</span>
                            <button class="btn btn-primary btn-sm" onclick="showAddTechnicianModal('INFRAESTRUCTURA')">
                                ‚ûï Agregar
                            </button>
                        </div>
                    </div>
                    <div class="card-content">
                        <div id="infraestructura-technicians-list">
                            <div style="text-align: center; padding: 2rem; color: #6b7280;">
                                <div style="font-size: 3rem; margin-bottom: 1rem;">üèóÔ∏è</div>
                                <h4>No hay personal registrado</h4>
                                <p style="font-size: 0.875rem;">El personal se guardar√° autom√°ticamente</p>
                                <button class="btn btn-primary btn-sm" onclick="showAddTechnicianModal('INFRAESTRUCTURA')" style="margin-top: 1rem;">
                                    ‚ûï Agregar Primera Persona
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Estad√≠sticas de Personal -->
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">üìä Estad√≠sticas de Personal</h3>
                </div>
                <div class="card-content">
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-bottom: 1.5rem;">
                        <div style="text-align: center; padding: 1rem; background: #f8fafc; border-radius: 0.5rem;">
                            <div style="font-size: 2rem; font-weight: bold; color: #2563eb;" id="total-technicians">0</div>
                            <div style="color: #6b7280; font-size: 0.875rem;">Total Personal</div>
                        </div>
                        <div style="text-align: center; padding: 1rem; background: #eff6ff; border-radius: 0.5rem;">
                            <div style="font-size: 2rem; font-weight: bold; color: #2563eb;" id="total-engineers">0</div>
                            <div style="color: #6b7280; font-size: 0.875rem;">Ingenieros</div>
                        </div>
                        <div style="text-align: center; padding: 1rem; background: #f0fdf4; border-radius: 0.5rem;">
                            <div style="font-size: 2rem; font-weight: bold; color: #059669;" id="total-technicians-only">0</div>
                            <div style="color: #6b7280; font-size: 0.875rem;">T√©cnicos</div>
                        </div>
                        <div style="text-align: center; padding: 1rem; background: #f0fdf4; border-radius: 0.5rem;">
                            <div style="font-size: 2rem; font-weight: bold; color: #059669;" id="available-technicians">0</div>
                            <div style="color: #6b7280; font-size: 0.875rem;">Disponibles</div>
                        </div>
                    </div>

                    <!-- Indicador de Persistencia -->
                    <div style="background: #f8fafc; padding: 1rem; border-radius: 0.5rem; border-left: 3px solid #059669;">
                        <h4 style="color: #1f2937; margin-bottom: 0.5rem;">üíæ Estado de Persistencia</h4>
                        <ul style="color: #6b7280; font-size: 0.875rem; line-height: 1.6;">
                            <li><strong>‚úÖ Guardado autom√°tico:</strong> Los datos se almacenan inmediatamente</li>
                            <li><strong>‚úÖ Persistencia GitHub:</strong> Compatible con GitHub Pages</li>
                            <li><strong>‚úÖ Recuperaci√≥n:</strong> Los datos permanecen al recargar la p√°gina</li>
                            <li><strong>üíΩ Almacenamiento:</strong> localStorage del navegador (no requiere servidor)</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <!-- Accesos View -->
        <div id="accesos-view" class="view hidden">
            <div class="alert alert-info">
                <h3 style="font-weight: 600; margin-bottom: 0.5rem;">üî¢ Sistema de C√≥digos de Acceso</h3>
                <p>Sistema de c√≥digos √∫nicos de 4 d√≠gitos con persistencia completa en GitHub Pages.</p>
            </div>

            <!-- Estad√≠sticas de Accesos -->
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-bottom: 1.5rem;">
                <div class="metric-card total">
                    <div class="metric-icon">üë•</div>
                    <div class="metric-number" id="total-users">0</div>
                    <div class="metric-label">Usuarios Registrados</div>
                </div>
                <div class="metric-card pendientes">
                    <div class="metric-icon">‚è≥</div>
                    <div class="metric-number" id="pending-access">0</div>
                    <div class="metric-label">Accesos Pendientes</div>
                </div>
                <div class="metric-card biomedica">
                    <div class="metric-icon">‚úÖ</div>
                    <div class="metric-number" id="approved-users">0</div>
                    <div class="metric-label">Usuarios Aprobados</div>
                </div>
            </div>

            <!-- Usuarios Aprobados -->
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">‚úÖ Usuarios con Acceso Aprobado</h2>
                    <div style="display: flex; gap: 0.5rem;">
                        <button class="btn btn-success btn-sm" onclick="addSampleUser()">
                            ‚ûï Agregar Usuario de Prueba
                        </button>
                        <button class="btn btn-warning btn-sm" onclick="exportUsersList()">
                            üì§ Exportar Lista
                        </button>
                    </div>
                </div>
                <div class="card-content">
                    <div id="approved-users-list">
                        <div style="text-align: center; padding: 2rem; color: #6b7280;">
                            <div style="font-size: 3rem; margin-bottom: 1rem;">üë•</div>
                            <h4>No hay usuarios aprobados</h4>
                            <p style="font-size: 0.875rem;">Los usuarios se guardar√°n autom√°ticamente</p>
                            <button class="btn btn-primary btn-sm" onclick="addSampleUser()" style="margin-top: 1rem;">
                                ‚ûï Agregar Usuario de Prueba
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Reportes View -->
        <div id="reportes-view" class="view hidden">
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">üìà Reportes y Estad√≠sticas</h2>
                    <div style="display: flex; gap: 0.5rem;">
                        <button class="btn btn-primary btn-sm" onclick="generateReport()">
                            üìä Generar Reporte
                        </button>
                        <button class="btn btn-success btn-sm" onclick="exportAllData()">
                            üì§ Exportar Todos los Datos
                        </button>
                    </div>
                </div>
                <div class="card-content">
                    <div id="reports-content">
                        <div style="text-align: center; padding: 2rem; color: #6b7280;">
                            <div style="font-size: 3rem; margin-bottom: 1rem;">üìä</div>
                            <h4>Reportes del Sistema</h4>
                            <p style="font-size: 0.875rem;">Genere reportes completos del estado del sistema</p>
                            <button class="btn btn-primary" onclick="generateReport()" style="margin-top: 1rem;">
                                üìà Generar Reporte Ahora
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- System Status -->
    <div class="system-status">
        <div class="status-online">
            üíæ Persistencia Activa
        </div>
    </div>

    <script>
        // ===== SISTEMA DE PERSISTENCIA CORREGIDO =====
        let solicitudes = [];
        let tecnicosPorArea = {
            'INGENIERIA_BIOMEDICA': [],
            'MECANICA': [],
            'INFRAESTRUCTURA': []
        };
        let accessRequests = [];
        let approvedUsers = [];

        // Claves de localStorage
        const STORAGE_KEYS = {
            SOLICITUDES: 'hospital_solicitudes_v2',
            TECNICOS: 'hospital_tecnicos_v2',
            ACCESS_REQUESTS: 'hospital_access_v2',
            APPROVED_USERS: 'hospital_approved_v2'
        };

        // ===== FUNCIONES DE PERSISTENCIA MEJORADAS =====
        function saveToLocalStorage(key, data) {
            try {
                const jsonData = JSON.stringify(data);
                localStorage.setItem(key, jsonData);
                console.log(`üíæ Guardado ${key}:`, data);
                updateSystemStatus(`Datos guardados: ${new Date().toLocaleTimeString()}`);
                return true;
            } catch (error) {
                console.error(`‚ùå Error guardando ${key}:`, error);
                return false;
            }
        }

        function loadFromLocalStorage(key, defaultValue = []) {
            try {
                const data = localStorage.getItem(key);
                if (data && data !== 'null' && data !== 'undefined') {
                    const parsed = JSON.parse(data);
                    console.log(`üìÇ Cargado ${key}:`, parsed);
                    return parsed;
                }
                console.log(`üìÇ No hay datos para ${key}, usando valor por defecto`);
                return defaultValue;
            } catch (error) {
                console.error(`‚ùå Error cargando ${key}:`, error);
                return defaultValue;
            }
        }

        function saveAllData() {
            const results = {
                solicitudes: saveToLocalStorage(STORAGE_KEYS.SOLICITUDES, solicitudes),
                tecnicos: saveToLocalStorage(STORAGE_KEYS.TECNICOS, tecnicosPorArea),
                accessRequests: saveToLocalStorage(STORAGE_KEYS.ACCESS_REQUESTS, accessRequests),
                approvedUsers: saveToLocalStorage(STORAGE_KEYS.APPROVED_USERS, approvedUsers)
            };
            
            const allSaved = Object.values(results).every(result => result === true);
            updateSystemStatus(allSaved ? '‚úÖ Todos los datos guardados' : '‚ö†Ô∏è Error al guardar algunos datos');
            return allSaved;
        }

        function loadAllData() {
            solicitudes = loadFromLocalStorage(STORAGE_KEYS.SOLICITUDES, []);
            tecnicosPorArea = loadFromLocalStorage(STORAGE_KEYS.TECNICOS, {
                'INGENIERIA_BIOMEDICA': [],
                'MECANICA': [],
                'INFRAESTRUCTURA': []
            });
            accessRequests = loadFromLocalStorage(STORAGE_KEYS.ACCESS_REQUESTS, []);
            approvedUsers = loadFromLocalStorage(STORAGE_KEYS.APPROVED_USERS, []);
            
            // Asegurar estructura correcta de t√©cnicos
            if (!tecnicosPorArea['INGENIERIA_BIOMEDICA']) tecnicosPorArea['INGENIERIA_BIOMEDICA'] = [];
            if (!tecnicosPorArea['MECANICA']) tecnicosPorArea['MECANICA'] = [];
            if (!tecnicosPorArea['INFRAESTRUCTURA']) tecnicosPorArea['INFRAESTRUCTURA'] = [];
            
            console.log('üìÇ Todos los datos cargados exitosamente');
            updateAllDisplays();
            updateSystemStatus('üìÇ Datos cargados correctamente');
        }

        // ===== MAPAS DE DATOS =====
        const serviciosIngenieria = {
            'INGENIERIA_BIOMEDICA': 'Ingenier√≠a Biom√©dica',
            'INFRAESTRUCTURA': 'Infraestructura',
            'MECANICA': 'Mec√°nica'
        };

        const iconosIngenieria = {
            'INGENIERIA_BIOMEDICA': 'üè•',
            'INFRAESTRUCTURA': 'üèóÔ∏è',
            'MECANICA': '‚öôÔ∏è'
        };

        // ===== FUNCIONES DE GESTI√ìN DE T√âCNICOS =====
        function showAddTechnicianModal(area = '') {
            const modalHTML = `
                <div id="add-technician-modal" class="modal">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h3 class="modal-title">‚ûï Agregar Personal T√©cnico</h3>
                            <button class="modal-close" onclick="closeModal('add-technician-modal')">‚úï</button>
                        </div>
                        <div style="padding: 1.5rem;">
                            <form id="add-technician-form">
                                <div class="form-group">
                                    <label class="form-label">üîß √Årea *</label>
                                    <select id="tech-area" class="form-select" required>
                                        <option value="">Seleccionar √°rea</option>
                                        <option value="INGENIERIA_BIOMEDICA" ${area === 'INGENIERIA_BIOMEDICA' ? 'selected' : ''}>üè• Ingenier√≠a Biom√©dica</option>
                                        <option value="MECANICA" ${area === 'MECANICA' ? 'selected' : ''}>‚öôÔ∏è Mec√°nica</option>
                                        <option value="INFRAESTRUCTURA" ${area === 'INFRAESTRUCTURA' ? 'selected' : ''}>üèóÔ∏è Infraestructura</option>
                                    </select>
                                </div>
                                
                                <div class="form-group">
                                    <label class="form-label">üë®‚Äçüéì Tipo *</label>
                                    <select id="tech-type" class="form-select" required>
                                        <option value="">Seleccionar tipo</option>
                                        <option value="INGENIERO">üéì Ingeniero</option>
                                        <option value="TECNICO">üîß T√©cnico</option>
                                    </select>
                                </div>
                                
                                <div class="form-group">
                                    <label class="form-label">üë§ Nombre Completo *</label>
                                    <input type="text" id="tech-name" class="form-input" required placeholder="Nombre y apellidos">
                                </div>
                                
                                <div class="form-group">
                                    <label class="form-label">üéì Especialidad *</label>
                                    <input type="text" id="tech-specialty" class="form-input" required placeholder="√Årea de especializaci√≥n">
                                </div>
                                
                                <div class="form-group">
                                    <label class="form-label">üìû Tel√©fono *</label>
                                    <input type="tel" id="tech-phone" class="form-input" required placeholder="+57 300 123 4567">
                                </div>
                                
                                <div class="form-group">
                                    <label class="form-label">üìß Email *</label>
                                    <input type="email" id="tech-email" class="form-input" required placeholder="email@hospital.com">
                                </div>
                                
                                <div class="form-group">
                                    <label class="form-label">üìã Estado</label>
                                    <select id="tech-status" class="form-select">
                                        <option value="disponible">‚úÖ Disponible</option>
                                        <option value="ocupado">‚è≥ Ocupado</option>
                                        <option value="inactivo">‚ùå Inactivo</option>
                                    </select>
                                </div>
                                
                                <div style="background: #f0f9ff; padding: 1rem; border-radius: 0.5rem; margin: 1rem 0;">
                                    <h4 style="color: #1e40af; margin-bottom: 0.5rem;">üíæ Persistencia Garantizada</h4>
                                    <p style="color: #1e40af; margin: 0; font-size: 0.875rem;">Los datos se guardan autom√°ticamente y permanecen en GitHub Pages.</p>
                                </div>
                                
                                <div style="display: flex; gap: 1rem; justify-content: end; margin-top: 1.5rem;">
                                    <button type="button" class="btn btn-secondary" onclick="closeModal('add-technician-modal')">Cancelar</button>
                                    <button type="submit" class="btn btn-success">‚úÖ Guardar Personal</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.insertAdjacentHTML('beforeend', modalHTML);
            
            document.getElementById('add-technician-form').addEventListener('submit', function(e) {
                e.preventDefault();
                addTechnician();
            });
        }

        function addTechnician() {
            const formData = {
                area: document.getElementById('tech-area').value,
                type: document.getElementById('tech-type').value,
                name: document.getElementById('tech-name').value.trim(),
                specialty: document.getElementById('tech-specialty').value.trim(),
                phone: document.getElementById('tech-phone').value.trim(),
                email: document.getElementById('tech-email').value.trim(),
                status: document.getElementById('tech-status').value || 'disponible'
            };

            // Validaci√≥n
            for (const [key, value] of Object.entries(formData)) {
                if (key !== 'status' && (!value || value === '')) {
                    alert(`‚ùå Por favor complete el campo: ${key}`);
                    return;
                }
            }

            // Generar ID √∫nico
            const areaPrefix = {
                'INGENIERIA_BIOMEDICA': 'IB',
                'MECANICA': 'ME',
                'INFRAESTRUCTURA': 'IN'
            }[formData.area] || 'XX';

            const existingIds = tecnicosPorArea[formData.area].map(t => t.id);
            let counter = 1;
            let newId;
            do {
                newId = `${areaPrefix}${String(counter).padStart(3, '0')}`;
                counter++;
            } while (existingIds.includes(newId));

            // Crear nuevo t√©cnico
            const prefix = formData.type === 'INGENIERO' ? 'Ing.' : 'T√©c.';
            const newTechnician = {
                id: newId,
                nombre: `${prefix} ${formData.name}`,
                tipo: formData.type,
                especialidad: formData.specialty,
                telefono: formData.phone,
                email: formData.email,
                estado: formData.status,
                fechaCreacion: new Date().toLocaleString('es-CO'),
                disponible: formData.status === 'disponible'
            };

            // Agregar y guardar
            tecnicosPorArea[formData.area].push(newTechnician);
            saveToLocalStorage(STORAGE_KEYS.TECNICOS, tecnicosPorArea);

            // Cerrar modal y actualizar
            closeModal('add-technician-modal');
            updateAllDisplays();

            const areaName = serviciosIngenieria[formData.area];
            alert(`‚úÖ ${formData.type} agregado exitosamente a ${areaName}\n\nüÜî ID: ${newId}\nüë§ Nombre: ${newTechnician.nombre}\nüíæ Guardado autom√°ticamente`);
        }

        function addSampleTechnicians() {
            const samples = [
                {
                    area: 'INGENIERIA_BIOMEDICA',
                    type: 'INGENIERO',
                    name: 'Mar√≠a Garc√≠a L√≥pez',
                    specialty: 'Equipos Cr√≠ticos',
                    phone: '+57 300 123 4567',
                    email: 'maria.garcia@hospital.com',
                    status: 'disponible'
                },
                {
                    area: 'MECANICA',
                    type: 'TECNICO',
                    name: 'Carlos Rodr√≠guez P√©rez',
                    specialty: 'Sistemas HVAC',
                    phone: '+57 301 987 6543',
                    email: 'carlos.rodriguez@hospital.com',
                    status: 'disponible'
                },
                {
                    area: 'INFRAESTRUCTURA',
                    type: 'INGENIERO',
                    name: 'Ana Mart√≠nez Silva',
                    specialty: 'Construcci√≥n Hospitalaria',
                    phone: '+57 302 456 7890',
                    email: 'ana.martinez@hospital.com',
                    status: 'disponible'
                }
            ];

            let added = 0;
            samples.forEach(sample => {
                const areaPrefix = {
                    'INGENIERIA_BIOMEDICA': 'IB',
                    'MECANICA': 'ME',
                    'INFRAESTRUCTURA': 'IN'
                }[sample.area];

                const existingIds = tecnicosPorArea[sample.area].map(t => t.id);
                let counter = 1;
                let newId;
                do {
                    newId = `${areaPrefix}${String(counter).padStart(3, '0')}`;
                    counter++;
                } while (existingIds.includes(newId));

                const prefix = sample.type === 'INGENIERO' ? 'Ing.' : 'T√©c.';
                const newTechnician = {
                    id: newId,
                    nombre: `${prefix} ${sample.name}`,
                    tipo: sample.type,
                    especialidad: sample.specialty,
                    telefono: sample.phone,
                    email: sample.email,
                    estado: sample.status,
                    fechaCreacion: new Date().toLocaleString('es-CO'),
                    disponible: sample.status === 'disponible'
                };

                tecnicosPorArea[sample.area].push(newTechnician);
                added++;
            });

            saveToLocalStorage(STORAGE_KEYS.TECNICOS, tecnicosPorArea);
            updateAllDisplays();

            alert(`‚úÖ ${added} personas de prueba agregadas exitosamente\n\nüíæ Datos guardados autom√°ticamente en GitHub Pages`);
        }

        function deleteTechnician(area, techId) {
            const technician = tecnicosPorArea[area]?.find(t => t.id === techId);
            if (!technician) {
                alert('‚ùå Personal no encontrado');
                return;
            }

            const confirmation = confirm(`¬øEliminar a ${technician.nombre}?\n\n‚ö†Ô∏è Esta acci√≥n no se puede deshacer.`);
            if (confirmation) {
                const index = tecnicosPorArea[area].findIndex(t => t.id === techId);
                if (index > -1) {
                    tecnicosPorArea[area].splice(index, 1);
                    saveToLocalStorage(STORAGE_KEYS.TECNICOS, tecnicosPorArea);
                    updateAllDisplays();
                    alert(`üóëÔ∏è ${technician.nombre} eliminado exitosamente`);
                }
            }
        }

        function toggleTechnicianStatus(area, techId) {
            const technician = tecnicosPorArea[area]?.find(t => t.id === techId);
            if (!technician) return;

            const statuses = ['disponible', 'ocupado', 'inactivo'];
            const currentIndex = statuses.indexOf(technician.estado);
            const nextIndex = (currentIndex + 1) % statuses.length;
            const newStatus = statuses[nextIndex];

            technician.estado = newStatus;
            technician.disponible = newStatus === 'disponible';

            saveToLocalStorage(STORAGE_KEYS.TECNICOS, tecnicosPorArea);
            updateAllDisplays();

            alert(`‚úÖ Estado cambiado: ${technician.nombre} ‚Üí ${newStatus}`);
        }

        function clearAllTechnicians() {
            const total = Object.values(tecnicosPorArea).reduce((sum, area) => sum + area.length, 0);
            if (total === 0) {
                alert('üìã No hay personal registrado');
                return;
            }

            const confirmation = confirm(`¬øEliminar TODOS los ${total} registros de personal?\n\n‚ö†Ô∏è Esta acci√≥n no se puede deshacer.`);
            if (confirmation) {
                tecnicosPorArea = {
                    'INGENIERIA_BIOMEDICA': [],
                    'MECANICA': [],
                    'INFRAESTRUCTURA': []
                };
                saveToLocalStorage(STORAGE_KEYS.TECNICOS, tecnicosPorArea);
                updateAllDisplays();
                alert('üóëÔ∏è Todo el personal ha sido eliminado');
            }
        }

        // ===== FUNCIONES DE GESTI√ìN DE SOLICITUDES =====
        function addSampleRequest() {
            const samples = [
                {
                    numero: `SOL-${Date.now()}-001`,
                    servicioIngenieria: 'INGENIERIA_BIOMEDICA',
                    tipoServicio: 'CORRECTIVO',
                    prioridad: 'ALTA',
                    descripcion: 'Ventilador mec√°nico presenta falla en el sistema de alarmas',
                    equipo: 'Ventilador Mec√°nico Modelo VM-300',
                    ubicacion: 'UCI - Cama 15',
                    solicitante: 'Dr. Juan P√©rez',
                    servicioHospitalario: 'UCI_ADULTO',
                    fechaCreacion: new Date().toLocaleString('es-CO'),
                    estado: 'PENDIENTE',
                    tecnicoAsignado: null
                },
                {
                    numero: `SOL-${Date.now()}-002`,
                    servicioIngenieria: 'MECANICA',
                    tipoServicio: 'PREVENTIVO',
                    prioridad: 'MEDIA',
                    descripcion: 'Mantenimiento rutinario del sistema de aire acondicionado',
                    equipo: 'Sistema HVAC Central',
                    ubicacion: 'Quir√≥fano 3',
                    solicitante: 'Ing. Ana Garc√≠a',
                    servicioHospitalario: 'CIRUGIA',
                    fechaCreacion: new Date().toLocaleString('es-CO'),
                    estado: 'PENDIENTE',
                    tecnicoAsignado: null
                }
            ];

            const randomSample = samples[Math.floor(Math.random() * samples.length)];
            solicitudes.push(randomSample);
            saveToLocalStorage(STORAGE_KEYS.SOLICITUDES, solicitudes);
            updateAllDisplays();

            alert(`‚úÖ Solicitud de prueba agregada\n\nüìã N√∫mero: ${randomSample.numero}\nüîß √Årea: ${serviciosIngenieria[randomSample.servicioIngenieria]}\nüíæ Guardado autom√°ticamente`);
        }

        // ===== FUNCIONES DE GESTI√ìN DE ACCESOS =====
        function addSampleUser() {
            const newUser = {
                id: `USR-${Date.now()}`,
                nombreCompleto: `Dr. Usuario Prueba ${Date.now().toString().slice(-4)}`,
                email: `usuario.prueba${Date.now().toString().slice(-4)}@hospital.com`,
                telefono: '+57 300 123 4567',
                numeroDocumento: Math.floor(10000000 + Math.random() * 90000000).toString(),
                servicioHospitalario: 'URGENCIAS',
                cargo: 'M√©dico Especialista',
                fechaAprobacion: new Date().toISOString(),
                aprobadoPor: 'Sistema de Prueba',
                estado: 'ACTIVO',
                codigoAcceso: Math.floor(1000 + Math.random() * 9000).toString(),
                fechaGeneracionCodigo: new Date().toISOString()
            };

            approvedUsers.push(newUser);
            saveToLocalStorage(STORAGE_KEYS.APPROVED_USERS, approvedUsers);
            updateAllDisplays();

            alert(`‚úÖ Usuario de prueba agregado\n\nüë§ ${newUser.nombreCompleto}\nüî¢ C√≥digo: ${newUser.codigoAcceso}\nüíæ Guardado autom√°ticamente`);
        }

        function exportUsersList() {
            if (approvedUsers.length === 0) {
                alert('üìã No hay usuarios para exportar');
                return;
            }

            const exportData = {
                fechaExportacion: new Date().toLocaleString('es-CO'),
                totalUsuarios: approvedUsers.length,
                usuarios: approvedUsers
            };

            const dataStr = JSON.stringify(exportData, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            
            const link = document.createElement('a');
            link.href = URL.createObjectURL(dataBlob);
            link.download = `usuarios_hospital_${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            
            alert(`üì§ Lista de ${approvedUsers.length} usuarios exportada exitosamente`);
        }

        // ===== FUNCIONES DE VISUALIZACI√ìN =====
        function updateAllDisplays() {
            updateAllCounters();
            updateTechniciansDisplay();
            updateRequestsDisplay();
            updateAccessDisplay();
            updatePersonnelSummaries();
        }

        function updateAllCounters() {
            // Contadores de solicitudes
            const total = solicitudes.length;
            const biomedica = solicitudes.filter(r => r.servicioIngenieria === 'INGENIERIA_BIOMEDICA').length;
            const mecanica = solicitudes.filter(r => r.servicioIngenieria === 'MECANICA').length;
            const infraestructura = solicitudes.filter(r => r.servicioIngenieria === 'INFRAESTRUCTURA').length;
            const pendientes = solicitudes.filter(r => r.estado === 'PENDIENTE' || !r.tecnicoAsignado).length;

            document.getElementById('metric-total').textContent = total;
            document.getElementById('metric-biomedica').textContent = biomedica;
            document.getElementById('metric-mecanica').textContent = mecanica;
            document.getElementById('metric-infraestructura').textContent = infraestructura;
            document.getElementById('metric-pendientes').textContent = pendientes;
            document.getElementById('total-count').textContent = total;
            document.getElementById('notification-count').textContent = pendientes;
            document.getElementById('tab-biomedica-count').textContent = biomedica;
            document.getElementById('tab-mecanica-count').textContent = mecanica;
            document.getElementById('tab-infraestructura-count').textContent = infraestructura;

            // Contadores de t√©cnicos
            const totalTech = Object.values(tecnicosPorArea).reduce((sum, area) => sum + area.length, 0);
            const biomedicaTech = tecnicosPorArea['INGENIERIA_BIOMEDICA'].length;
            const mecanicaTech = tecnicosPorArea['MECANICA'].length;
            const infraestructuraTech = tecnicosPorArea['INFRAESTRUCTURA'].length;

            document.getElementById('total-technicians-nav').textContent = totalTech;
            document.getElementById('biomedica-total').textContent = `${biomedicaTech} personas`;
            document.getElementById('mecanica-total').textContent = `${mecanicaTech} personas`;
            document.getElementById('infraestructura-total').textContent = `${infraestructuraTech} personas`;
            document.getElementById('total-technicians').textContent = totalTech;

            // Contar por tipo
            let engineers = 0, technicians = 0, available = 0;
            Object.values(tecnicosPorArea).forEach(area => {
                area.forEach(person => {
                    if (person.tipo === 'INGENIERO') engineers++;
                    else technicians++;
                    if (person.estado === 'disponible') available++;
                });
            });

            document.getElementById('total-engineers').textContent = engineers;
            document.getElementById('total-technicians-only').textContent = technicians;
            document.getElementById('available-technicians').textContent = available;

            // Contadores de accesos
            document.getElementById('total-users').textContent = approvedUsers.length;
            document.getElementById('pending-access').textContent = accessRequests.length;
            document.getElementById('approved-users').textContent = approvedUsers.length;
            document.getElementById('pending-access-count').textContent = accessRequests.length;

            // Contadores de personal en dashboard
            document.getElementById('biomedica-personnel-count').textContent = `${biomedicaTech} registrados`;
            document.getElementById('mecanica-personnel-count').textContent = `${mecanicaTech} registrados`;
            document.getElementById('infraestructura-personnel-count').textContent = `${infraestructuraTech} registrados`;
        }

        function updateTechniciansDisplay() {
            const areas = [
                { key: 'INGENIERIA_BIOMEDICA', name: 'biomedica', icon: 'üè•' },
                { key: 'MECANICA', name: 'mecanica', icon: '‚öôÔ∏è' },
                { key: 'INFRAESTRUCTURA', name: 'infraestructura', icon: 'üèóÔ∏è' }
            ];

            areas.forEach(area => {
                const technicians = tecnicosPorArea[area.key] || [];
                const container = document.getElementById(`${area.name}-technicians-list`);
                
                if (!container) return;

                if (technicians.length === 0) {
                    container.innerHTML = `
                        <div style="text-align: center; padding: 2rem; color: #6b7280;">
                            <div style="font-size: 3rem; margin-bottom: 1rem;">${area.icon}</div>
                            <h4>No hay personal registrado</h4>
                            <p style="font-size: 0.875rem;">El personal se guardar√° autom√°ticamente</p>
                            <button class="btn btn-primary btn-sm" onclick="showAddTechnicianModal('${area.key}')" style="margin-top: 1rem;">
                                ‚ûï Agregar Primera Persona
                            </button>
                        </div>
                    `;
                } else {
                    container.innerHTML = technicians.map(tech => createTechnicianCard(tech, area.key)).join('');
                }
            });
        }

        function createTechnicianCard(tech, area) {
            const statusClass = `status-${tech.estado}`;
            const typeIcon = tech.tipo === 'INGENIERO' ? 'üéì' : 'üîß';
            
            return `
                <div class="technician-card">
                    <div class="technician-header">
                        <div class="technician-name">${typeIcon} ${tech.nombre}</div>
                        <div class="technician-id">${tech.id}</div>
                    </div>
                    <div class="technician-details">
                        <div class="technician-detail">
                            <span>üéØ</span>
                            <span>${tech.especialidad}</span>
                        </div>
                        <div class="technician-detail">
                            <span>üìû</span>
                            <span>${tech.telefono}</span>
                        </div>
                        <div class="technician-detail">
                            <span>üìß</span>
                            <span>${tech.email}</span>
                        </div>
                        <div class="technician-detail">
                            <span>üìÖ</span>
                            <span>${tech.fechaCreacion}</span>
                        </div>
                    </div>
                    <div style="margin-bottom: 1rem;">
                        <span class="${statusClass}">${tech.estado.charAt(0).toUpperCase() + tech.estado.slice(1)}</span>
                    </div>
                    <div class="technician-actions">
                        <button class="btn btn-warning btn-sm" onclick="toggleTechnicianStatus('${area}', '${tech.id}')">
                            üîÑ Cambiar Estado
                        </button>
                        <button class="btn btn-danger btn-sm" onclick="deleteTechnician('${area}', '${tech.id}')">
                            üóëÔ∏è Eliminar
                        </button>
                    </div>
                </div>
            `;
        }

        function updateRequestsDisplay() {
            const container = document.getElementById('solicitudes-list');
            
            if (solicitudes.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 3rem; color: #6b7280;">
                        <div style="font-size: 4rem; margin-bottom: 1rem;">üìã</div>
                        <h3 style="color: #1f2937; margin-bottom: 0.5rem;">No hay solicitudes registradas</h3>
                        <p style="margin-bottom: 1.5rem;">Las solicitudes se guardar√°n autom√°ticamente</p>
                        <button class="btn btn-primary" onclick="addSampleRequest()">
                            ‚ûï Agregar Solicitud de Prueba
                        </button>
                    </div>
                `;
            } else {
                container.innerHTML = solicitudes
                    .sort((a, b) => new Date(b.fechaCreacion) - new Date(a.fechaCreacion))
                    .map(request => createRequestCard(request))
                    .join('');
            }
        }

        function createRequestCard(request) {
            const areaInfo = serviciosIngenieria[request.servicioIngenieria] || 'Sin especificar';
            const iconoArea = iconosIngenieria[request.servicioIngenieria] || 'üîß';
            
            return `
                <div class="request-card pending">
                    <div class="request-header">
                        <div class="request-number">üìã ${request.numero}</div>
                        <div style="display: flex; gap: 0.5rem; align-items: center;">
                            <span class="status-pendiente">${request.estado}</span>
                            <span style="background: #f59e0b; color: white; padding: 0.25rem 0.5rem; border-radius: 0.375rem; font-size: 0.75rem;">
                                ${request.prioridad}
                            </span>
                        </div>
                    </div>
                    
                    <div style="background: linear-gradient(135deg, #f8fafc 0%, #e0f2fe 100%); padding: 1rem; border-radius: 0.5rem; margin-bottom: 1rem;">
                        <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem;">
                            <span style="font-size: 1.25rem;">${iconoArea}</span>
                            <strong style="color: #1f2937;">√Årea: ${areaInfo}</strong>
                        </div>
                        <div style="font-size: 0.875rem; color: #6b7280;">
                            <strong>Tipo:</strong> ${request.tipoServicio} |
                            <strong>Equipo:</strong> ${request.equipo}
                        </div>
                    </div>

                    <div class="request-details">
                        <div class="request-detail">
                            <div class="request-detail-label">üè• Servicio</div>
                            <div class="request-detail-value">${request.servicioHospitalario}</div>
                        </div>
                        <div class="request-detail">
                            <div class="request-detail-label">üë§ Solicitante</div>
                            <div class="request-detail-value">${request.solicitante}</div>
                        </div>
                        <div class="request-detail">
                            <div class="request-detail-label">üìç Ubicaci√≥n</div>
                            <div class="request-detail-value">${request.ubicacion}</div>
                        </div>
                        <div class="request-detail">
                            <div class="request-detail-label">üìÖ Fecha</div>
                            <div class="request-detail-value">${request.fechaCreacion}</div>
                        </div>
                    </div>

                    <div style="margin: 1rem 0; padding: 1rem; background: #f8fafc; border-radius: 0.5rem;">
                        <div class="request-detail-label">üìù Descripci√≥n</div>
                        <div style="margin-top: 0.5rem; color: #1f2937;">${request.descripcion}</div>
                    </div>

                    <div class="request-actions">
                        <button class="btn btn-success btn-sm" onclick="assignTechnician('${request.numero}')">
                            üë®‚Äçüîß Asignar T√©cnico
                        </button>
                        <button class="btn btn-primary btn-sm" onclick="viewRequest('${request.numero}')">
                            üëÅÔ∏è Ver Detalles
                        </button>
                    </div>
                </div>
            `;
        }

        function updateAccessDisplay() {
            const container = document.getElementById('approved-users-list');
            
            if (approvedUsers.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 2rem; color: #6b7280;">
                        <div style="font-size: 3rem; margin-bottom: 1rem;">üë•</div>
                        <h4>No hay usuarios aprobados</h4>
                        <p style="font-size: 0.875rem;">Los usuarios se guardar√°n autom√°ticamente</p>
                        <button class="btn btn-primary btn-sm" onclick="addSampleUser()" style="margin-top: 1rem;">
                            ‚ûï Agregar Usuario de Prueba
                        </button>
                    </div>
                `;
            } else {
                container.innerHTML = approvedUsers.map(user => createUserCard(user)).join('');
            }
        }

        function createUserCard(user) {
            return `
                <div class="request-card" style="border-left: 4px solid #059669; background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%);">
                    <div class="request-header">
                        <div class="request-number">‚úÖ ${user.nombreCompleto}</div>
                        <div style="display: flex; gap: 0.5rem; align-items: center;">
                            <span class="status-completada">ACTIVO</span>
                            <div style="background: #2563eb; color: white; padding: 0.25rem 0.5rem; border-radius: 0.375rem; font-size: 0.75rem;">${user.id}</div>
                        </div>
                    </div>
                    
                    <div class="request-details">
                        <div class="request-detail">
                            <div class="request-detail-label">üìß Email</div>
                            <div class="request-detail-value">${user.email}</div>
                        </div>
                        <div class="request-detail">
                            <div class="request-detail-label">üè• Servicio</div>
                            <div class="request-detail-value">${user.servicioHospitalario}</div>
                        </div>
                        <div class="request-detail">
                            <div class="request-detail-label">üëî Cargo</div>
                            <div class="request-detail-value">${user.cargo}</div>
                        </div>
                        <div class="request-detail">
                            <div class="request-detail-label">üìÖ Aprobado</div>
                            <div class="request-detail-value">${new Date(user.fechaAprobacion).toLocaleString('es-CO')}</div>
                        </div>
                    </div>

                    <div class="access-code-display">
                        <div class="access-code-label">üî¢ C√ìDIGO DE ACCESO</div>
                        <div class="access-code-number">${user.codigoAcceso}</div>
                        <div class="access-code-info">Generado: ${new Date(user.fechaGeneracionCodigo).toLocaleString('es-CO')}</div>
                    </div>

                    <div class="request-actions">
                        <button class="btn btn-primary btn-sm" onclick="regenerateCode('${user.id}')">
                            üîÑ Regenerar C√≥digo
                        </button>
                        <button class="btn btn-warning btn-sm" onclick="copyCode('${user.codigoAcceso}')">
                            üìã Copiar C√≥digo
                        </button>
                    </div>
                </div>
            `;
        }

        function updatePersonnelSummaries() {
            const areas = [
                { key: 'INGENIERIA_BIOMEDICA', name: 'biomedica' },
                { key: 'MECANICA', name: 'mecanica' },
                { key: 'INFRAESTRUCTURA', name: 'infraestructura' }
            ];

            areas.forEach(area => {
                const personnel = tecnicosPorArea[area.key] || [];
                const summaryContainer = document.getElementById(`${area.name}-personnel-summary`);
                
                if (!summaryContainer) return;

                if (personnel.length === 0) {
                    summaryContainer.innerHTML = '<p style="color: #6b7280; text-align: center;">No hay personal registrado</p>';
                } else {
                    const available = personnel.filter(p => p.estado === 'disponible').length;
                    const busy = personnel.filter(p => p.estado === 'ocupado').length;
                    const inactive = personnel.filter(p => p.estado === 'inactivo').length;
                    
                    summaryContainer.innerHTML = `
                        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 0.5rem; text-align: center;">
                            <div>
                                <div style="font-weight: bold; color: #059669;">${available}</div>
                                <div style="font-size: 0.75rem; color: #6b7280;">Disponibles</div>
                            </div>
                            <div>
                                <div style="font-weight: bold; color: #f59e0b;">${busy}</div>
                                <div style="font-size: 0.75rem; color: #6b7280;">Ocupados</div>
                            </div>
                            <div>
                                <div style="font-weight: bold; color: #ef4444;">${inactive}</div>
                                <div style="font-size: 0.75rem; color: #6b7280;">Inactivos</div>
                            </div>
                        </div>
                    `;
                }
            });
        }

        // ===== FUNCIONES AUXILIARES =====
        function updateSystemStatus(message) {
            const statusElement = document.querySelector('.system-status .status-online');
            if (statusElement) {
                statusElement.textContent = message;
            }
        }

        function closeModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.remove();
            }
        }

        function copyCode(code) {
            navigator.clipboard.writeText(code).then(() => {
                alert(`üìã C√≥digo ${code} copiado al portapapeles`);
            }).catch(() => {
                const textArea = document.createElement('textarea');
                textArea.value = code;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                alert(`üìã C√≥digo ${code} copiado al portapapeles`);
            });
        }

        function regenerateCode(userId) {
            const user = approvedUsers.find(u => u.id === userId);
            if (user) {
                const oldCode = user.codigoAcceso;
                const newCode = Math.floor(1000 + Math.random() * 9000).toString();
                
                user.codigoAcceso = newCode;
                user.fechaGeneracionCodigo = new Date().toISOString();
                
                saveToLocalStorage(STORAGE_KEYS.APPROVED_USERS, approvedUsers);
                updateAccessDisplay();
                
                alert(`üîÑ C√≥digo regenerado\n\nüë§ ${user.nombreCompleto}\nüî¢ C√≥digo anterior: ${oldCode}\nüî¢ C√≥digo nuevo: ${newCode}`);
            }
        }

        function assignTechnician(requestNumber) {
            alert('üîß Funci√≥n de asignaci√≥n en desarrollo');
        }

        function viewRequest(requestNumber) {
            const request = solicitudes.find(r => r.numero === requestNumber);
            if (request) {
                alert(`üìã Detalles de la solicitud\n\nüÜî ${request.numero}\nüîß ${serviciosIngenieria[request.servicioIngenieria]}\nüìù ${request.descripcion}\nüìÖ ${request.fechaCreacion}`);
            }
        }

        function syncData() {
            saveAllData();
            updateAllDisplays();
            alert('üîÑ Datos sincronizados correctamente\n\nüíæ Todo guardado en localStorage para GitHub Pages');
        }

        function generateReport() {
            const totalSolicitudes = solicitudes.length;
            const totalTecnicos = Object.values(tecnicosPorArea).reduce((sum, area) => sum + area.length, 0);
            const totalUsuarios = approvedUsers.length;
            
            const report = `üìä REPORTE DEL SISTEMA - ${new Date().toLocaleString('es-CO')}

üìã SOLICITUDES:
‚Ä¢ Total: ${totalSolicitudes}
‚Ä¢ Biom√©dica: ${solicitudes.filter(r => r.servicioIngenieria === 'INGENIERIA_BIOMEDICA').length}
‚Ä¢ Mec√°nica: ${solicitudes.filter(r => r.servicioIngenieria === 'MECANICA').length}
‚Ä¢ Infraestructura: ${solicitudes.filter(r => r.servicioIngenieria === 'INFRAESTRUCTURA').length}

üë• PERSONAL T√âCNICO:
‚Ä¢ Total: ${totalTecnicos}
‚Ä¢ Biom√©dica: ${tecnicosPorArea['INGENIERIA_BIOMEDICA'].length}
‚Ä¢ Mec√°nica: ${tecnicosPorArea['MECANICA'].length}
‚Ä¢ Infraestructura: ${tecnicosPorArea['INFRAESTRUCTURA'].length}

üîê USUARIOS CON ACCESO:
‚Ä¢ Total aprobados: ${totalUsuarios}

üíæ PERSISTENCIA:
‚Ä¢ ‚úÖ Datos guardados en localStorage
‚Ä¢ ‚úÖ Compatible con GitHub Pages
‚Ä¢ ‚úÖ Sin necesidad de servidor

Estado: SISTEMA FUNCIONANDO CORRECTAMENTE`;

            document.getElementById('reports-content').innerHTML = `
                <div style="background: #f8fafc; padding: 1.5rem; border-radius: 0.75rem; border-left: 4px solid #2563eb;">
                    <pre style="white-space: pre-wrap; font-family: monospace; font-size: 0.875rem; margin: 0;">${report}</pre>
                </div>
            `;
        }

        function exportAllData() {
            const allData = {
                fechaExportacion: new Date().toLocaleString('es-CO'),
                solicitudes: solicitudes,
                tecnicosPorArea: tecnicosPorArea,
                approvedUsers: approvedUsers,
                resumen: {
                    totalSolicitudes: solicitudes.length,
                    totalTecnicos: Object.values(tecnicosPorArea).reduce((sum, area) => sum + area.length, 0),
                    totalUsuarios: approvedUsers.length
                }
            };

            const dataStr = JSON.stringify(allData, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            
            const link = document.createElement('a');
            link.href = URL.createObjectURL(dataBlob);
            link.download = `hospital_backup_${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            
            alert('üì§ Backup completo exportado exitosamente');
        }

        // ===== FUNCIONES DE NAVEGACI√ìN =====
        function showView(viewName) {
            const views = document.querySelectorAll('.view');
            views.forEach(view => view.classList.add('hidden'));
            
            const targetView = document.getElementById(viewName + '-view');
            if (targetView) {
                targetView.classList.remove('hidden');
            }
            
            const tabs = document.querySelectorAll('.nav-tab');
            tabs.forEach(tab => tab.classList.remove('active'));
            
            const activeTab = document.querySelector(`[data-view="${viewName}"]`);
            if (activeTab) {
                activeTab.classList.add('active');
            }

            updateAllCounters();
        }

        function showAreaTab(areaName) {
            document.querySelectorAll('.area-content').forEach(content => {
                content.classList.add('hidden');
            });
            
            const targetArea = document.getElementById(`area-${areaName}`);
            if (targetArea) {
                targetArea.classList.remove('hidden');
            }
            
            document.querySelectorAll('.area-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            const activeTab = document.querySelector(`[data-area="${areaName}"]`);
            if (activeTab) {
                activeTab.classList.add('active');
            }

            showAreaRequests(getAreaKeyFromName(areaName));
        }

        function getAreaKeyFromName(areaName) {
            const areaMap = {
                'biomedica': 'INGENIERIA_BIOMEDICA',
                'mecanica': 'MECANICA',
                'infraestructura': 'INFRAESTRUCTURA'
            };
            return areaMap[areaName] || 'INGENIERIA_BIOMEDICA';
        }

        function showAreaRequests(areaKey) {
            const areaRequests = solicitudes.filter(r => r.servicioIngenieria === areaKey);
            const areaNames = {
                'INGENIERIA_BIOMEDICA': 'biomedica',
                'MECANICA': 'mecanica',
                'INFRAESTRUCTURA': 'infraestructura'
            };
            
            const containerName = areaNames[areaKey];
            const container = document.getElementById(`${containerName}-requests`);
            
            if (!container) return;
            
            if (areaRequests.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 2rem; color: #6b7280;">
                        <div style="font-size: 3rem; margin-bottom: 1rem;">${iconosIngenieria[areaKey]}</div>
                        <h4>No hay solicitudes para ${serviciosIngenieria[areaKey]}</h4>
                        <p style="font-size: 0.875rem;">Las solicitudes aparecer√°n aqu√≠ autom√°ticamente</p>
                        <button class="btn btn-primary btn-sm" onclick="addSampleRequest()" style="margin-top: 1rem;">
                            ‚ûï Agregar Solicitud de Prueba
                        </button>
                    </div>
                `;
            } else {
                container.innerHTML = areaRequests.map(request => createRequestCard(request)).join('');
            }
        }

        function filterByArea(area) {
            console.log(`Filtrando por √°rea: ${area}`);
        }

        function filterByStatus(status) {
            console.log(`Filtrando por estado: ${status}`);
        }

        function showNotifications() {
            const totalPersonnel = Object.values(tecnicosPorArea).reduce((sum, area) => sum + area.length, 0);
            const pendingRequests = solicitudes.filter(r => r.estado === 'PENDIENTE').length;
            const totalUsers = approvedUsers.length;
            
            alert(`üîî ESTADO DEL SISTEMA\n\nüìä RESUMEN:\n‚Ä¢ ${solicitudes.length} Solicitudes totales\n‚Ä¢ ${pendingRequests} Solicitudes pendientes\n‚Ä¢ ${totalPersonnel} Personal t√©cnico registrado\n‚Ä¢ ${totalUsers} Usuarios con acceso aprobado\n\nüíæ PERSISTENCIA:\n‚Ä¢ ‚úÖ Datos guardados autom√°ticamente\n‚Ä¢ ‚úÖ Compatible con GitHub Pages\n‚Ä¢ ‚úÖ Sin p√©rdida de informaci√≥n\n\nüöÄ Sistema funcionando correctamente`);
        }

        // ===== INICIALIZACI√ìN =====
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üöÄ Portal de Gesti√≥n con Persistencia - Hospital Susana L√≥pez de Valencia');
            console.log('üíæ Iniciando sistema de persistencia para GitHub Pages...');
            
            // Cargar todos los datos
            loadAllData();
            
            // Actualizar estado del sistema
            updateSystemStatus('‚úÖ Sistema iniciado correctamente');
            
            console.log('‚úÖ Sistema inicializado con persistencia completa');
            console.log('üíæ localStorage configurado para GitHub Pages');
            console.log('üîÑ Datos se guardan autom√°ticamente');
        });
    </script>
</body>
</html>